(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bececd4"],{"03f4":function(t,e,n){},2532:function(t,e,n){"use strict";var i=n("23e7"),o=n("5a34"),r=n("1d80"),s=n("ab13");i({target:"String",proto:!0,forced:!s("includes")},{includes:function(t){return!!~String(r(this)).indexOf(o(t),arguments.length>1?arguments[1]:void 0)}})},"569d":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",staticClass:"danmu-pool"})},o=[],r=(n("7db0"),n("4160"),n("caad6"),n("b64b"),n("2532"),n("159b"),{props:{danmu:{type:Array,default:function(){return[]}},isPlaying:{type:Boolean}},data:function(){return{MAX_COUNT_INLINE:8,TRACK_COUNT:12,barrages:[],rollDomPool:[],topDomPool:[],bottomDomPool:[],lastDom:[],timer:null,interval:300,freeRollTrack:[],freeTopTrack:[],freeBottomTrack:[],container:null,cssLsit:["color","font-size"]}},watch:{isPlaying:function(t){t?this.danmuPlay():this.danmuPause()}},methods:{init:function(){var t=this;this.$refs.container.innerHTML="";for(var e=function(e){for(var n=[],i=function(i){var o=document.createElement("span");o.className="roll-danmu",o.style.top="".concat(1.3*e,"em"),o.addEventListener("animationend",(function(){o.style.animationName="",o.style.transform="translateX(-100%)",o.style.border="none",t.cssLsit.forEach((function(t){o.style[t]=null})),t.rollDomPool[e][i]&&(t.rollDomPool[e][i].isFree=!0)})),n.push({el:o,row:e,col:i,isFree:!0,isAppended:!1})},o=0;o<t.MAX_COUNT_INLINE;o++)i(o);t.rollDomPool.push(n)},n=0;n<this.TRACK_COUNT;n++)e(n);for(var i=0;i<this.TRACK_COUNT;i++)this.freeRollTrack[i]=!0,this.freeTopTrack[i]=!0,this.freeBottomTrack[i]=!0},findFreeRollDom:function(t){return this.rollDomPool[t].find((function(t){return t.isFree}))},getTrack:function(t){var e=null;if("roll"===t)e=this.freeRollTrack;else if("top"===t)e=this.freeTopTrack;else{if("bottom"!==t)return-1;e=this.freeBottomTrack}for(var n=0;n<this.TRACK_COUNT;n++)if(e[n])return n;return-1},shootRollDanmu:function(t,e,n){var i=this;this.freeRollTrack[n]=!1,t.isFree=!1;var o=t.el;!t.isAppended&&this.container&&(t.isAppended=!0,this.container.appendChild(o)),o.innerText=e.content,t.duration=this.container.clientWidth/150,t.speed=(this.container.clientWidth+o.clientWidth)/t.duration;var r=0,s=this.lastDom[n];if(s&&!s.isFree){var a=s.el.getBoundingClientRect().right-this.container.getBoundingClientRect().left,l=a/s.speed,c=t.speed*l,u=c-this.container.clientWidth;u>0&&(r=u/t.speed,o.style.animationDelay="".concat(r,"s"))}if(this.lastDom[n]=t,e.style){"string"===typeof e.style&&(e.style=JSON.parse(e.style));var f=Object.keys(e.style);f.forEach((function(t){i.cssLsit.includes(t)&&(o.style[t]=e.style[t])}))}e.isCurr&&(o.style.border="1px solid #FF6B6B"),o.style.animationName="danmu-roll",o.style.transform="translateX(".concat(this.container.clientWidth,"px)"),o.style.animationDuration="".concat(t.duration,"s"),setTimeout((function(){i.freeRollTrack[n]=!0}),1e3*(o.clientWidth/t.speed+r))},shootFixedDanmu:function(t,e,n){var i=this,o=null;if("top"===t)o=this.topDomPool;else{if("bottom"!==t)return;o=this.bottomDomPool}this.freeTopTrack[n]=!1;var r,s=1.5;if(o[n]?r=o[n]:(r=document.createElement("div"),r.className="fixed-danmu",r.style[t]="".concat(1.3*n,"em"),r.style.animationName="danmu-away",r.style.animationDuration="".concat(s,"s"),this.container.appendChild(r)),r.addEventListener("animationend",(function(){r.style.visibility="hidden",i.cssLsit.forEach((function(t){r.style[t]=null})),i.freeTopTrack[n]=!0})),r.style.visibility="visible",r.innerText=e.content,e.isCurr&&(r.style.border="1px solid #FF6B6B"),e.style){"string"===typeof e.style&&(e.style=JSON.parse(e.style));var a=Object.keys(e.style);a.forEach((function(t){i.cssLsit.includes(t)&&(r.style[t]=e.style[t])}))}},danmuPlay:function(){for(var t=this,e=0;e<this.TRACK_COUNT;e++)for(var n=0;n<this.MAX_COUNT_INLINE;n++)this.rollDomPool[e][n].isFree||(this.rollDomPool[e][n].el.style.animationPlayState="");this.timer=setInterval((function(){if(t.danmu.length>0){var e=t.danmu.shift(),n=e.type;if("roll"===n){var i=t.getTrack(n);if(i>-1){var o=t.findFreeRollDom(i);if(null!=o)return void t.shootRollDanmu(o,e,i)}t.danmu.push(e)}else if("top"===n||"bottom"===n){var r=t.getTrack(n);r>-1?t.shootFixedDanmu(n,e,r):t.danmu.push(e)}}}),this.interval)},danmuPause:function(){clearInterval(this.timer);for(var t=0;t<this.TRACK_COUNT;t++)for(var e=0;e<this.MAX_COUNT_INLINE;e++)this.rollDomPool[t][e].isFree||(this.rollDomPool[t][e].el.style.animationPlayState="paused")}},mounted:function(){this.container=this.$refs.container,this.init(),this.isPlaying&&this.danmuPlay()},beforeDestroy:function(){this.danmuPause()}}),s=r,a=(n("61ce"),n("2877")),l=Object(a["a"])(s,i,o,!1,null,null,null);e["default"]=l.exports},"5a34":function(t,e,n){var i=n("44e7");t.exports=function(t){if(i(t))throw TypeError("The method doesn't accept regular expressions");return t}},"61ce":function(t,e,n){"use strict";var i=n("03f4"),o=n.n(i);o.a},ab13:function(t,e,n){var i=n("b622"),o=i("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[o]=!1,"/./"[t](e)}catch(i){}}return!1}},caad6:function(t,e,n){"use strict";var i=n("23e7"),o=n("4d64").includes,r=n("44d2"),s=n("ae40"),a=s("indexOf",{ACCESSORS:!0,1:0});i({target:"Array",proto:!0,forced:!a},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),r("includes")}}]);
//# sourceMappingURL=chunk-3bececd4.5ad6fe10.js.map